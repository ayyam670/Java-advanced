<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.board.mapper.BoardMapper">
	<resultMap type="BoardVO" id="boardmap">
		<id column="bno" property="bno" />
		<result column="TITLE" property="title" />
		<result column="CONTENT" property="content" />
		<result column="WRITER" property="writer" />
		<result column="REGDATE" property="regdate" />
		<result column="UPDATEDATE" property="updatedate" />

		<collection property="reply" ofType="ReplyVO">
			<id column="RNO" property="rno" />
			<result column="REPLY" property="reply" />
			<result column="REPLYER" property="replyer" />
		</collection>
	</resultMap>

	<select id="getListByWriter">
		SELECT *
		FROM tbl_board
		<where>
			<if test="writer != null">AND writer Like '%' || #{writer} || '%'</if>
			<if test="title != null">AND title Like '%' || #{title} || '%'</if>
			<!-- '%${ }%' 위와 같음 -->
		</where>
	</select>


	<select id="getList" resultMap="boardmap">
		SELECT A.*,
		B.RNO,
		B.REPLY,
		B.REPLYER
		FROM TBL_BOARD A
		LEFT OUTER JOIN TBL_REPLY B
		ON (A.BNO = B.BNO)
	</select>

	<insert id="insert">
		<selectKey keyProperty="bno" order="BEFORE" resultType="long">
			SELECT SEQ_BOARD.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO TBL_BOARD(BNO, TITLE, CONTENT, WRITER)
		VALUES(#{bno}, #{title}, #{content}, #{writer})
	</insert>
	
	<!-- 단건조회 -->
	<select id="getBoard">
		SELECT *
		  FROM tbl_board
		 WHERE bno= #{bno}
	</select>

	<update id="update">
		UPDATE tbl_board
		SET content = #{content},
		title =
		#{title},
		writer = #{writer}
		WHERE bno = #{bno}
	</update>

	<delete id="delete" statementType="CALLABLE" parameterType="map">
	{ call PROC_BOARD_DELETE(#{bno} , #{result, mode=OUT , jdbcType=VARCHAR, javaType=string} ) }
	                    <!--(IN모드 , OUT모드 변수)  -->
	</delete>

	<!-- <delete id="delete">
		DELETE FROM tbl_reply
		WHERE bno = #{bno}
	</delete>
	<delete id="delete">
		DELETE FROM tbl_board
		WHERE bno = #{bno}
	</delete> -->

	<select id="count">
		select count(*) from tbl_board
	</select>

</mapper>